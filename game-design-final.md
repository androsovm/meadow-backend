# The Meadow - Final Game Design Document
## Симулятор сенокоса | Объединенный документ

**Версия:** 1.0 Final
**Дата:** Февраль 2026
**Платформа:** Web (Browser-based)
**Движок:** Phaser 3 / PixiJS + Colyseus

---

## Вклад экспертов

### Blizzard Art Director - "Polish & Feel"
- Система Perfect Mow с детальным timing window
- Combo система с визуальными наградами (chain эффекты)
- Particle systems с конкретными параметрами
- Screen shake и animation juice (squash & stretch)
- Звуковой layering и adaptive music
- Мультиплеерные "wow" моменты (финал стога)
- Детальная система освещения и color grading

### Stardew Valley Designer - "Loops & Retention"
- Progression loops (micro, meso, macro)
- Сезонная структура контента
- "One more day" эффект через незавершенные дела
- Система коллекционирования и достижений
- Рецепты и готовка как вечерний ритуал
- Баланс продуктивности и отдыха
- Мелкие детали оживляющие мир

### Senior Game Designer - "Systems & Scale"
- Мультиплеер архитектура (client prediction, latency hiding)
- Технические ограничения веба и оптимизация
- Risk assessment и митигация
- Accessibility опции
- Scalability серверов
- Этичная монетизация (cosmetics only)
- Метрики успеха и KPI

---

# Философия дизайна

## Три столпа

| Столп | Определение | Как достигаем | Метрика успеха |
|-------|-------------|---------------|----------------|
| **Медитация** | Погружение через ритм и повторение | Fidget-механика косьбы, adaptive music | Время сессии > 20 мин |
| **Красота** | Каждый кадр достоин скриншота | Polish, частицы, освещение, время суток | NPS по эстетике > 8/10 |
| **Уют** | Ощущение безопасности и тепла | Костер, готовка, социальные механики | Retention D7 > 30% |

## Главный принцип
> "Если игрок нажал кнопку и ничего визуально/аудиально не произошло - это баг."

## Anti-Patterns (чего избегаем)

| Избегаем | Почему | Альтернатива |
|----------|--------|--------------|
| FOMO механики | Разрушают расслабление | Все доступно всегда |
| Наказания | Создают стресс | Только позитивные подкрепления |
| Энергия/Стамина | Искусственные ограничения | Бесконечный геймплей |
| Gacha/Lootboxes | Азартный элемент | Прямые покупки |
| Агрессивные напоминания | Раздражение | Мягкие уведомления |

---

# Core Loop

## Иерархия циклов

### Macro Loop (Сезон: 1-4 часа)
```
Утро (Косьба) -> День (Сборка) -> Вечер (Отдых) -> Ночь (Социал)
Цель сезона: Собрать N стогов + Разблокировать новую область/декор
```

### Session Loop (15-30 минут)
```
Прибытие -> Выбор активности -> Работа <-> Перерыв (каждые 5-7 мин) -> Прощание
```

### Micro Loop (30 секунд - 2 минуты)
```
Подход к траве -> Замах (тайминг) -> Скос -> Фидбек -> Подбор -> Переноска -> Укладка
```

### Fidget Loop (2-5 секунд) - ЯДРО ИГРЫ
```
Зажать ЛКМ -> Шкала заполняется -> Отпустить в sweet spot -> Сатисфакция
```

## Оптимизация Core Loop

| Метрика | Целевое значение | Решение |
|---------|------------------|---------|
| Time to First Reward | < 30 секунд | Мгновенный feedback при первом скосе |
| Actions per Minute | 8-12 | Оптимальный темп для "flow state" |
| Decisions per Minute | 2-4 | Не перегружать когнитивно |
| Walking Time % | < 30% | Копны можно начинать где угодно |

---

# Механика косьбы - Fidget System

## Базовая механика

Игрок зажимает ЛКМ, шкала заполняется за 1000ms:

```
[░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░]
0ms                                           1000ms
     ▲                    ▲                    ▲
   Начало            SWEET SPOT           Перезамах
  (слабый)          (400-600ms)        (теряем ритм)
```

## Timing Windows - Точные параметры

| Зона | Время (ms) | Результат | Visual Feedback | Audio | Reward |
|------|------------|-----------|-----------------|-------|--------|
| Too Early | 0-200 | Трава не падает | Красное мерцание | Глухой "тук" | 0 |
| Early | 200-400 | Криво падает | Оранжевое мерцание | Мягкий "вжих" | 0.5x |
| **Perfect** | **400-600** | **Идеальный скос** | **Золотое свечение + искры** | **Сочный "ШШАХ" + звон** | **1.5x + combo** |
| Late | 600-800 | Падает медленно | Оранжевое мерцание | Обычный звук | 0.8x |
| Too Late | 800-1000 | Сбивается замах | Красное мерцание | Глухой звук | 0 |
| Overhold | >1000 | Автоматический отпуск | Сброс | Тишина | 0 |

## Combo Chain System

| Combo | Эффект | Визуал | Аудио |
|-------|--------|--------|-------|
| x3 | +10% качество | Легкий shimmer | Звук усиливается |
| x5 | +20% качество | Золотой след за косой | Добавляется перкуссия |
| x10 | "FLOW STATE" | Виньетирование, время -10% | Полная мелодия |
| x20 | Мультиплеер notify | Радужный след, имя светится | Колокольчики |
| x50 | Achievement | Коса светится до конца сессии | Крещендо |

**Важно:** Combo влияет ТОЛЬКО на эстетику, не на gameplay advantage.

### Прощение ошибок
- 1 "Early/Late" не сбрасывает combo, только останавливает рост
- Только "Too Early/Too Late" сбрасывает combo
- Это создает напряжение без фрустрации

## Screen Shake - Микро-параметры

```javascript
const screenShake = {
    none:    { intensity: 0, duration: 0 },
    normal:  { intensity: 0.5, duration: 50 },   // Едва заметная
    good:    { intensity: 1, duration: 80 },     // Приятная
    perfect: { intensity: 2, duration: 120 }     // Удовлетворяющая
};
// Важно: тряска СУБТИЛЬНАЯ - это медитация, не экшн
```

## Particle Systems - Точные параметры

### При обычном взмахе
```javascript
grassParticles: {
    count: 5-8,
    colors: ['#7CB342', '#689F38', '#558B2F'], // градиент зелени
    size: { min: 2, max: 4 }, // px
    lifetime: { min: 400, max: 600 }, // ms
    direction: 'swing_direction + random(-15, 15)', // degrees
    gravity: 0.3,
    rotation: 'random_spin'
}
```

### При идеальном взмахе (добавляется)
```javascript
perfectSparkles: {
    count: 12-16,
    colors: ['#FFD700', '#FFA000'], // золотой градиент
    size: { min: 1, max: 3 },
    lifetime: { min: 300, max: 500 },
    behavior: 'fan_out_then_fall'
},
waveRing: {
    color: 'rgba(255, 236, 179, 0.3)',
    radius: { start: 0, end: 32 }, // px
    duration: 200, // ms
    alpha: { start: 0.3, end: 0 }
},
scytheTrail: {
    color: '#FFFDE7',
    width: 3, // px
    duration: 200, // ms
    alpha: { start: 1, end: 0 }
}
```

### Пыль при падении травы
```javascript
dustCloud: {
    count: 3-5,
    color: 'rgba(215, 204, 200, 0.3)',
    size: { min: 4, max: 8 },
    lifetime: { min: 300, max: 400 },
    behavior: 'rise_and_fade'
}
```

## Animation Juice - Squash & Stretch

### Игрок при косьбе
```javascript
mowAnimation: {
    anticipation: { // 50ms перед замахом
        scaleX: 0.98, scaleY: 1.02, duration: 50
    },
    windup: { // 150ms замах
        scaleX: 0.95, scaleY: 1.05, duration: 150
    },
    strike: { // 100ms удар
        scaleX: 1.15, scaleY: 0.90, duration: 100
    },
    recovery: { // 200ms восстановление
        scaleX: 1.0, scaleY: 1.0, duration: 200, easing: 'easeOutBack'
    }
}
```

### Трава при падении
```javascript
grassFallAnimation: {
    cutMoment: {
        scale: [1.0, 0.8, 1.1, 1.0], // последовательность
        direction: 'away_from_swing'
    },
    falling: {
        rotation: { target: 'random(-15, 15)', duration: 300 },
        bounces: 2, // при приземлении
        bounceDamping: 0.6
    }
}
```

---

# Система времени суток

## Цикл дня

| Время игровое | Реальное время | Длительность | Визуальные особенности |
|---------------|----------------|--------------|------------------------|
| 05:00-06:00 | 0-1 мин | 1 мин | Рассвет, розово-оранжевые тона, длинные тени, туман |
| 06:00-09:00 | 1-4 мин | 3 мин | Утро, свежие зеленые тона, роса на траве (блики) |
| 09:00-12:00 | 4-7 мин | 3 мин | День, яркие цвета, короткие тени |
| 12:00-15:00 | 7-10 мин | 3 мин | Полдень, жаркое солнце, сено сохнет быстрее |
| 15:00-18:00 | 10-13 мин | 3 мин | Послеполуденный, теплые тона |
| 18:00-21:00 | 13-16 мин | 3 мин | Золотой час, все залито теплым светом |
| 21:00-00:00 | 16-19 мин | 3 мин | Сумерки, синие тона, светлячки |
| 00:00-05:00 | 19-24 мин | 5 мин | Ночь, луна, звезды, костры светятся |

**Полный цикл: 24 реальных минуты = 24 игровых часа**

## Color Grading

```css
:root {
    /* Время суток */
    --dawn: rgba(255, 183, 178, 0.15);
    --morning: rgba(255, 255, 255, 0);
    --noon: rgba(255, 255, 255, 0);
    --golden-hour: rgba(255, 193, 7, 0.1);
    --dusk: rgba(63, 81, 181, 0.1);
    --night: rgba(25, 32, 72, 0.4);
}
```

```javascript
const timeOfDayFilters = {
    dawn:       { hueRotate: -10, saturate: 0.9, brightness: 0.85 },
    morning:    { hueRotate: 0, saturate: 1.0, brightness: 1.0 },
    noon:       { hueRotate: 0, saturate: 1.1, brightness: 1.1 },
    goldenHour: { sepia: 0.2, saturate: 1.3, brightness: 1.0 },
    dusk:       { hueRotate: 10, saturate: 0.8, brightness: 0.7 },
    night:      { saturate: 0.7, brightness: 0.5, blueOverlay: 0.3 }
};
```

## Динамические тени

- Тени вращаются в течение дня (угол от 0 до 360)
- Длина тени зависит от "высоты солнца":
  - Рассвет/Закат: тень = 3x высоты объекта
  - Полдень: тень = 0.5x высоты объекта
- Ночью: множественные мягкие тени от луны и костров

## Атмосферные элементы по времени

| Время | Элемент | Параметры |
|-------|---------|-----------|
| Утро | Роса на траве | Блики, исчезают к 10:00 |
| День | Пыльца/споры | 20-30 частиц, медленный дрейф |
| Вечер | Светлячки | Появляются с 20:00, 5-10 вокруг игрока |
| Ночь | Звезды | Мерцание, падающие каждые 2-5 мин |

---

# Уютные механики

## Костер

### Создание
```
Шаг 1: Собрать хворост (3 штуки с краев карты)
Шаг 2: Сложить в костровище
Шаг 3: Чиркнуть спичками (мини-игра: удержать 2 секунды)
Шаг 4: Костер горит 30 минут реального времени
```

### Визуальные параметры
```javascript
campfireVisuals: {
    flame: {
        frames: 8, // анимация огня
        lightRadius: 8, // тайлов
        colors: {
            core: '#FF6F00',
            mid: '#FFC107',
            glow: '#FFECB3'
        }
    },
    sparks: {
        rate: 2-3, // в секунду
        direction: 'up + random(-10, 10)',
        lifetime: 500
    },
    smoke: {
        particles: 2-4,
        color: 'rgba(100, 100, 100, 0.3)',
        behavior: 'rise_and_dissolve'
    },
    shadows: {
        flickering: true,
        intensity: 0.3,
        frequency: 100 // ms между изменениями
    }
}
```

### Звуковые параметры
```javascript
campfireSounds: {
    crackle: { variations: 5, interval: '2-5s' },
    spark: { variations: 3, chance: 0.1 }, // за секунду
    hum: { frequency: 'low', volume: 0.3 }
}
```

### Эффекты костра
- Радиус тепла: 5 тайлов
- Игроки в зоне получают визуальный эффект "согрет"
- Ночью - основной источник света и безопасности
- 2+ игрока у костра = бонусы к восстановлению

## Готовка

### Рецепты

| Блюдо | Ингредиенты | Время | Визуальный эффект | Как получить |
|-------|-------------|-------|-------------------|--------------|
| Чай с травами | Травы + Вода | 30 сек | Легкий пар над игроком | Начальный |
| Лепешка | Мука + Вода | 1 мин | - | Начальный |
| Жареные грибы | Грибы x3 | 1 мин | - | Начальный |
| Уха | Рыба + Травы + Вода | 2 мин | Золотистое свечение | 10 рыб поймано |
| Шашлык | Мясо + Палочка | 3 мин | Звездочки при ходьбе | Сезон 2 |
| Строганина | Замороженная рыба | 30 сек | +30% combo удержание | Сезон 2 |
| Саламат | Мука + Масло + Сметана | 2 мин | +15% ко всем бонусам | Найти рецепт |
| Керчэх | Сливки + Ягоды | 2 мин | Полное восстановление | Сезон 3, редкий |
| Кумыс | Молоко (ферментация) | 5 мин | +25% опыта на день | Секретный рецепт |

### Процесс готовки

```
1. Подойти к костру
2. Открыть меню готовки (E)
3. Выбрать рецепт (если есть ингредиенты)
4. Мини-игра:
   - Шкала заполняется (как косьба)
   - Помешать в нужный момент для бонуса
   - Снять с огня вовремя
5. Качество блюда зависит от тайминга:
   - Обычное: базовые эффекты
   - Хорошее: +25% к эффектам
   - Отличное: +50% к эффектам
   - Шедевр: +100% к эффектам, достижение
```

### Sharing механика
- Приготовленную еду можно передать другому игроку
- При передаче: сердечки, оба получают бафф
- Звук "ням-ням"
- +Friendship points

## Рыбалка

### Локация
Ручей на краю карты

### Механика
```
1. Подойти к воде с удочкой
2. Забросить (ЛКМ)
3. Ждать поклевки (5-30 секунд, расслабление)
4. При поклевке - мини-игра:

   СЛАБО <---------[рыба]----------> СИЛЬНО
         ░░░░░░░░░████░░░░░░░░░░
                  ^ Зеленая зона

   Удержать рыбку в центре 3 секунды
```

### Виды рыбы

| Рыба | Шанс | Сложность | Использование |
|------|------|-----------|---------------|
| Карась | 70% | Легко | Еда |
| Щука | 20% | Средне | Еда, трофей |
| Таймень | 9% | Сложно | Редкая еда |
| Легендарная | 1% | Очень сложно | Коллекция, достижение |

## Собирательство

| Предмет | Где найти | Использование |
|---------|-----------|---------------|
| Дикие травы | Везде | Чай, медицина |
| Ягоды (земляника) | Опушка леса | Еда, десерты |
| Ягоды (голубика) | Болотистые места | Еда, краситель |
| Грибы | Тень деревьев | Еда |
| Цветы | Луг, случайно | Декор, подарки |
| Хворост | Край леса | Костер |

### Редкие находки при косьбе

| Находка | Шанс | Эффект |
|---------|------|--------|
| Четырехлистный клевер | 0.5% | +10% удачи на день |
| Древний наконечник | 0.1% | Коллекция, продажа |
| Окаменелость | 0.05% | Коллекция, музей |
| Радужный цветок | 0.01% | Редкий подарок |

---

# Мультиплеер

## Философия
Не соревнование, а кооперация. Вместе работать, вместе отдыхать. "Тихая компания".

## Режимы

**Совместный луг (2-8 игроков):**
- Общее поле
- Общий прогресс к стогу
- Можно разделить роли (косит, собирает)
- Общий костер вечером

## Социальные механики

### Sync Bonus
Когда 2+ игрока делают Perfect взмах одновременно (+-200ms):
- Золотая пульсирующая линия соединяет игроков
- Бонусные частицы между ними
- Гармоничный звук (аккорд вместо ноты)
- +10% к combo обоим

### Proximity Features

| Расстояние | Эффект |
|------------|--------|
| 0-2 тайла | Можно "дать пять" (emote) |
| 0-3 тайла | Видно имя и combo count |
| 3-10 тайлов | Видно имя |
| 10+ тайлов | Только силуэт и действия |

### Эмоции (клавиши 1-6)

| Клавиша | Эмоция | Анимация |
|---------|--------|----------|
| 1 | Привет | Машет рукой, сердечко |
| 2 | Спасибо/Поклон | Традиционный поклон |
| 3 | Дать пять | Работает рядом с другим игроком |
| 4 | Сесть | Садится на траву |
| 5 | Танец | Маленький веселый танец |
| 6 | Играть на хомусе | Варган, звук |

### Совместные действия
- Вместе нести большую копну (быстрее)
- Подпевать у костра
- Делиться едой (бонус обоим)
- Групповое фото (сохраняется)

## Финал стога - WOW момент

Последовательность событий когда стог собран на 100%:

```
0.0s: Последняя копна опущена
      - Замедление времени до 50%
      - Камера начинает отъезжать

0.5s: Все инструменты автоматически опускаются
      - Игроки поворачиваются к стогу

1.0s: Стог начинает светиться изнутри
      - Золотые частицы поднимаются

2.0s: Вспышка света!
      - Screen shake (легкий, intensity: 3, duration: 200)
      - Стог "расцветает" - добавляются финальные детали
      - Музыка достигает крещендо

3.0s: Над стогом появляется корона/венок
      - Имена всех участников отображаются
      - Начисляются очки

4.0s: Фейерверк из сена!
      - Частицы во все стороны
      - Звук радости

5.0s: Возврат к нормальному времени
      - Камера возвращается
      - Появляется экран статистики
```

**Бонус "Golden Hour Harvest":**
Если стог завершен именно в золотой час (18:00-21:00):
- Специальный визуальный эффект: стог залит золотым светом
- Уникальная анимация завершения
- Бонусные очки x1.5
- Exclusive badge для всех участников

## Дружба между игроками

| Уровень | Название | Разблокировка |
|---------|----------|---------------|
| 1 | Знакомые | Базовые эмоции |
| 2 | Приятели | Торговля |
| 3 | Друзья | Совместное несение, рецепты |
| 4 | Близкие друзья | Можно присоединиться к комнате |
| 5 | Побратимы | Особые эмоции |

---

# Звуковой дизайн

## Принцип "Layered Audio"

### Фоновый слой (Ambient) - ВСЕГДА играет

```
ПОСТОЯННО (микшируются):
+-- Ветер (низкочастотный гул, volume: 0.2)
+-- Птицы (случайные, каждые 10-30 сек)
+-- Насекомые (непрерывный, громче днем)
+-- Шелест травы (реагирует на ветер)
+-- Далекий лес (очень тихий, создает глубину)
```

### Динамический ambient по времени суток

| Время | Звуки |
|-------|-------|
| Утро | Активные птицы, роса капает |
| День | Громче насекомые, жаворонки |
| Вечер | Цикады, вечерние птицы |
| Ночь | Сверчки, совы, костер потрескивает |

### Слой действий

**Косьба:**
```javascript
scytheSounds: {
    variations: 5, // чтобы не надоедало
    pitchVariation: 0.05, // +-5%

    normal: {
        sound: 'grass_swish',
        volume: 0.6
    },
    good: {
        sound: 'grass_swish + metal_ring_light',
        volume: 0.7
    },
    perfect: {
        layers: [
            'grass_SWISH', // низкие-средние
            'metal_chime',  // высокие, delay 50ms
            'magic_shimmer', // очень тихий
            'micro_echo'     // пространство
        ],
        volume: 0.9
    }
}
```

**Шаги:**
```javascript
footstepSounds: {
    grass: { sound: 'soft_shush', variations: 4, pitch: 0.03 },
    earth: { sound: 'solid_thud', variations: 4, pitch: 0.03 },
    hay:   { sound: 'crunch_rustle', variations: 6, pitch: 0.03 }
}
// Громкость зависит от скорости движения
```

### Музыкальный слой - Adaptive Music

```javascript
adaptiveMusic: {
    baseAmbient: { // ВСЕГДА
        type: 'drones_pads',
        volume: 0.3
    },
    layers: {
        combo5:  { add: 'soft_percussion', volume: 0.2 },
        combo10: { add: 'guitar_arpeggios', volume: 0.3 },
        combo20: { add: 'full_melody_theme', volume: 0.4 }
    },
    crossfade: 2000, // ms, незаметный переход

    instruments: [
        'acoustic_guitar',
        'flute', // якутские мотивы
        'khomus', // варган
        'wood_percussion',
        'warm_chamber_strings'
    ],

    bpm: 60 // синхронизирован с оптимальным ритмом косьбы
}
```

### Пространственное аудио

```javascript
spatialAudio: {
    stereoPanning: true, // по позиции источника
    distanceAttenuation: {
        nearDistance: 5,   // тайлов, 100% громкость
        farDistance: 15,   // тайлов, 30% громкость
        beyondFar: 0.1     // только очень громкие звуки
    },
    reverb: {
        dry: 1.0,
        wet: 'distance / farDistance * 0.5'
    }
}
```

---

# Progression Loops

## Ежедневный цикл (Micro Loop)
```
Проснуться -> Проверить сено -> Косить -> Собирать -> Готовить ужин -> Отдых у костра -> Сон
```

Каждый день должен приносить:
- Ощущение прогресса (сколько скосил/собрал)
- Хотя бы одно маленькое открытие или событие
- Момент красоты (рассвет, закат, звезды)
- Социальное взаимодействие (если мультиплеер)

## Недельный цикл (Meso Loop)
```
День 1-2: Косьба нового участка
День 3-4: Сушка и сбор в копны
День 5-6: Сбор в стог
День 7: День отдыха (ярмарка в деревне)
```

## Сезонный цикл (Macro Loop)

### Сезон 1: Первый покос (Обучение)
- Маленькое поле (500 клеток)
- Знакомство с механиками
- Цель: собрать 30 копен
- Разблокировка: базовый лагерь

### Сезон 2: Большой луг (Развитие)
- Большое поле (1500 клеток)
- Появляются разные типы травы
- Цель: 80 копен + первый полный стог
- Разблокировка: улучшенные инструменты, рецепты

### Сезон 3: Дальние поля (Мастерство)
- Несколько полей, выбор маршрута
- Сложные условия
- Цель: 150 копен, специальное сено
- Разблокировка: легендарные инструменты

### Сезон 4+: Мастер-косец (Эндгейм)
- Все поля открыты
- Бесконечные цели
- Достижения, коллекционирование
- Мультиплеерные события

## Прогрессия инструментов

### Коса

| Уровень | Название | Особенность | Как получить |
|---------|----------|-------------|--------------|
| 1 | Дедова коса | Базовая | Начальная |
| 2 | Точеная коса | +10% окно Perfect | 50 Perfect скосов |
| 3 | Кованая коса | +20% окно, красивый след | 200 золота |
| 4 | Мастерская коса | +30% окно, двойной скос (редко) | 1000 золота + материалы |
| 5 | Легендарная | +50% окно, уникальный звук и визуал | Квест сезона 3 |

### Вилы

| Уровень | Название | Особенность | Как получить |
|---------|----------|-------------|--------------|
| 1 | Старые вилы | 1 единица за раз | Начальные |
| 2 | Крепкие вилы | 2 единицы | 100 переносов |
| 3 | Кованые вилы | 3 единицы, нет замедления | 300 золота |
| 4 | Мастерские вилы | 4 единицы, бонус к укладке | 1200 золота + материалы |

---

# Система достижений

## Категории

### Путь косца
| Достижение | Условие | Награда |
|------------|---------|---------|
| Первый взмах | Скосить первую траву | - |
| Начинающий косец | 100 скосов | Лента на косу |
| Опытный косец | 1000 скосов | Новый стиль косы |
| Мастер косьбы | 10000 скосов | Золотая коса (косметика) |
| Легендарный косец | 50000 скосов | Титул, особый эффект |

### Путь ритма
| Достижение | Условие | Награда |
|------------|---------|---------|
| В ритме | 10 Perfect подряд | - |
| Мелодия луга | 25 Perfect подряд | Музыкальный эффект |
| Симфония сенокоса | 50 Perfect подряд | Особый trail |
| Абсолютный ритм | 100 Perfect подряд | Легендарный титул |

### Путь созерцателя
| Достижение | Условие | Награда |
|------------|---------|---------|
| Рассвет | Увидеть рассвет | - |
| Закат | Увидеть закат | - |
| Звездная ночь | Провести ночь под звездами | Карта созвездий |
| Полнолуние | Увидеть полную луну | - |
| Северное сияние | Увидеть редкое событие | Особый фон |
| Все краски неба | Все небесные события | Титул "Созерцатель" |

### Секретные достижения
- Найти спящего зайца в траве
- Увидеть лису на рассвете
- Бабочка села на голову (редкое событие)
- Загадать желание на падающую звезду
- Приготовить шедевр в полнолуние

---

# "One More Day" эффект

## Крючки на завтра

### Незавершенные дела
- "Осталось 3 копны до стога"
- "Еще чуть-чуть до следующего уровня косы"
- "Завтра дособеру тот участок"

### Ожидания
- "Завтра на ярмарке будет редкий торговец"
- "Мой кумыс как раз доферментируется"
- "Друг обещал зайти вечером"

### Циклические события
- "Хочу увидеть следующий рассвет"
- "Интересно, что найду завтра"
- "Погода обещает быть хорошей"

## Баланс продуктивности и отдыха

### Проблема
Игрок не должен чувствовать, что "тратит время", если просто сидит и смотрит на закат.

### Решение

**1. Скрытые бонусы за отдых:**
- Сидеть у костра = восстановление
- Смотреть на закат = скрытый буст к качеству на следующий день
- Слушать музыку = ускорение прогрессии дружбы

**2. Нет наказания за бездействие:**
- День не заканчивается плохо, если ничего не сделал
- Нет "потерянных дней"
- Сено не портится мгновенно

**3. Мягкие напоминания вместо давления:**
- "Сегодня хороший день для косьбы" (не "Ты должен косить!")
- "Сено готово к сбору" (не "Собери или испортится!")

**4. Красота как награда:**
- Самые красивые моменты - когда ничего не делаешь
- Рассвет лучше виден, если не занят работой
- Звезды появляются только если остановиться

---

# Мультиплеер архитектура

## Общая схема

```
+-------------------------------------------------------+
|                     КЛИЕНТ (Browser)                   |
|  +-------------+  +-------------+  +-------------+    |
|  | Input       |  | Prediction  |  | Rendering   |    |
|  | Handler     |  | Layer       |  | Engine      |    |
|  +------+------+  +------+------+  +------+------+    |
|         |                |                |            |
|         +----------------+----------------+            |
|                          |                             |
|                   +------v------+                      |
|                   | WebSocket   |                      |
|                   | Client      |                      |
|                   +------+------+                      |
+------------------------- | ----------------------------+
                           |
                     +-----v-----+
                     | Internet  |
                     | (50-200ms)|
                     +-----+-----+
                           |
+------------------------- | ----------------------------+
|                    +-----v-----+                       |
|                    | WebSocket |                       |
|                    | Server    |                       |
|                    +-----+-----+                       |
|                          |                             |
|  +-----------------------------------------------+    |
|  |              Game State Manager                |    |
|  |  +-------------+  +-------------+  +---------+ |    |
|  |  | Player      |  | World       |  | Event   | |    |
|  |  | States      |  | State       |  | Queue   | |    |
|  |  +-------------+  +-------------+  +---------+ |    |
|  +-----------------------------------------------+    |
|                                                        |
|                     СЕРВЕР (Colyseus/Node.js)         |
+-------------------------------------------------------+
```

## Синхронизация

| Данные | Приоритет | Частота | Метод |
|--------|-----------|---------|-------|
| Позиция игрока | Высокий | 20 Hz | Delta compression |
| Состояние травы | Высокий | Event-based | Reliable |
| Анимации | Средний | Event-based | Unreliable |
| Копны/Стог | Высокий | Event-based | Reliable |
| Чат/Эмоции | Низкий | Event-based | Reliable |
| Время суток | Низкий | 1 Hz | Broadcast |

## Latency Hiding

### Client-Side Prediction
```javascript
function onMoveInput(direction) {
    // 1. Применяем локально сразу
    localPlayer.move(direction);

    // 2. Сохраняем в историю для reconciliation
    inputHistory.push({
        seq: nextSeq++,
        direction,
        timestamp: Date.now()
    });

    // 3. Отправляем на сервер
    socket.send({ type: "MOVE", direction, seq: currentSeq });
}

// При получении ответа сервера - reconciliation
function onServerUpdate(serverState) {
    const lastProcessedSeq = serverState.lastProcessedInput;
    inputHistory = inputHistory.filter(i => i.seq > lastProcessedSeq);
    localPlayer.setPosition(serverState.position);
    inputHistory.forEach(input => localPlayer.move(input.direction));
}
```

### Entity Interpolation для других игроков
```javascript
const INTERPOLATION_DELAY = 100; // ms буферизация

function renderOtherPlayer(player) {
    const renderTime = Date.now() - INTERPOLATION_DELAY;
    const [before, after] = findSurroundingStates(player.history, renderTime);

    if (before && after) {
        const t = (renderTime - before.timestamp) / (after.timestamp - before.timestamp);
        player.renderPosition = lerp(before.position, after.position, t);
    }
}
```

## Разрешение конфликтов

**Проблема:** Два игрока косят одну клетку одновременно

**Решение:** Server Authority + Optimistic UI
- Клиент показывает анимацию сразу (optimistic)
- Сервер решает кто первый
- Если конфликт - мягкий откат (не ошибка, просто "занято")

---

# Технические ограничения Web

## Браузерные лимиты

| Ограничение | Лимит | Решение |
|-------------|-------|---------|
| RAM | ~1.5GB max | Стриминг ассетов, LOD |
| WebSocket connections | 1-6 на домен | Один сокет, мультиплексирование |
| Local Storage | 5-10MB | Только критические данные |
| Audio contexts | 1 | AudioSprite, Web Audio API |
| Canvas size | 4096x4096 | Тайловый рендеринг |
| Frame rate | 60fps target | requestAnimationFrame |

## Оптимизация рендеринга

### Culling
Рендерим только видимые тайлы (camera viewport + 1 тайл буфер)

### Object Pooling
```javascript
class ParticlePool {
    constructor(size = 100) {
        this.pool = [];
        this.active = new Set();
        for (let i = 0; i < size; i++) {
            this.pool.push(new Particle());
        }
    }

    acquire() {
        if (this.pool.length > 0) {
            const p = this.pool.pop();
            this.active.add(p);
            return p;
        }
        return null;
    }

    release(p) {
        p.reset();
        this.active.delete(p);
        this.pool.push(p);
    }
}
```

### Sprite Batching
- Все тайлы травы - один draw call
- Все игроки - один draw call
- Particles - один draw call
- Цель: < 50 draw calls на кадр

## Asset Loading Strategy

```
Stage 1 (Критический) - < 500KB
- UI спрайты
- Игрок (idle)
- Базовые тайлы (10 штук)
- Критические звуки

Stage 2 (Gameplay) - < 2MB
- Все анимации игрока
- Все тайлы
- Инструменты
- Основные звуки

Stage 3 (Фоновый) - < 5MB
- Музыка (streaming)
- Ambient звуки
- Декорации
- Particles
```

## Совместимость браузеров

| Браузер | Минимум | Рекомендуется |
|---------|---------|---------------|
| Chrome | 80+ | 100+ |
| Firefox | 75+ | 95+ |
| Safari | 13+ | 15+ |
| Edge | 80+ | 100+ |
| Mobile Safari | iOS 13+ | iOS 15+ |
| Chrome Android | 80+ | 100+ |

---

# Accessibility

## Визуальная доступность

### Цветовая слепота
```javascript
const colorBlindModes = {
    normal:      { grass: '#4a7c23', hay: '#c4a052' },
    protanopia:  { grass: '#7c7c23', hay: '#c4c452' },
    deuteranopia:{ grass: '#6b7c23', hay: '#b4a052' },
    tritanopia:  { grass: '#4a5c83', hay: '#c49072' }
};
```

### High Contrast режим
- Усиленные границы объектов
- Увеличенные индикаторы
- Черно-белые иконки

### Размер текста
- Базовый: 16px
- Средний: 20px
- Большой: 24px
- Очень большой: 32px

## Моторная доступность

| Стандарт | Альтернатива |
|----------|--------------|
| Удержание ЛКМ | Toggle mode (один клик) |
| WASD | Стрелки, click-to-move |
| Быстрые клики | Auto-repeat при удержании |
| Тайминг косьбы | Auto-timing (всегда "Good") |

## Когнитивная доступность

### Упрощенный режим
- Меньше визуальных эффектов
- Четкие инструкции
- Постоянные подсказки

### Focus Mode
- Скрывает всех игроков кроме себя
- Убирает чат
- Минимальный UI

## Аудио доступность

### Визуальные заменители звуков

| Звук | Визуальная альтернатива |
|------|-------------------------|
| Успешный скос | Зеленая вспышка |
| Поклевка рыбы | Иконка восклицательного знака |
| Чат сообщение | Пульсация аватара |
| Смена времени | Плавное изменение цвета неба |

---

# Монетизация (этичная)

## Принципы

1. **Никаких преимуществ за деньги** (pay-to-win = 0)
2. **Только косметика**
3. **Прозрачные цены** (никаких loot boxes)
4. **Справедливый F2P опыт**
5. **Уважение к времени игрока**

## Модель: Cosmetic Shop + Battle Pass

### Премиум валюта: "Лепестки"
- 100 лепестков = $0.99
- 500 лепестков = $3.99 (бонус 20%)
- 1000 лепестков = $6.99 (бонус 30%)

### Каталог косметики

| Категория | Примеры | Цена (лепестки) |
|-----------|---------|-----------------|
| Косы | Золотая, Цветочная, Ледяная | 200-500 |
| Шляпы | Соломенная, Берет, Венок | 100-300 |
| Одежда | Рубашки, Сарафаны | 150-400 |
| Питомцы | Кот, Собака, Курица | 500-1000 |
| Эффекты | Следы, Ауры, Частицы | 300-600 |
| Эмодзи | Анимированные | 50-150 |
| Декор уголка | Мебель, Растения | 100-400 |

### Season Pass ($9.99)

**Бесплатный трек:** 30 уровней, базовые награды

**Премиум трек:**
- 30 уровней параллельно
- Эксклюзивные косметические награды
- Бонусные лепестки (~1500 за сезон)

### Этические ограничения - НЕ продаем:
- Ускорители
- Дополнительную энергию
- Loot boxes / Gacha
- "Convenience" items
- Эксклюзивный контент без F2P альтернативы

---

# Risk Assessment

## Технические риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| WebSocket disconnects | Средняя | Высокое | Exponential backoff, reconnection |
| Browser memory leaks | Высокая | Среднее | Object pooling, profiling |
| Mobile performance | Высокая | Высокое | LOD, reduced particles |
| Cross-browser bugs | Средняя | Среднее | Testing, polyfills |

## Геймдизайн риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Косьба станет скучной | Средняя | Критическое | Combo system, варианты травы |
| Мультиплеер грифинг | Высокая | Высокое | Report system, ограничения |
| Контент исчерпается | Высокая | Высокое | Сезонный контент |
| Токсичный чат | Высокая | Среднее | Модерация, фильтры, пресеты |

## Anti-Griefing система

```javascript
const newPlayerRestrictions = {
    canChat: false,           // Открывается после 1 часа
    canTrade: false,          // Открывается после 5 часов
    canJoinPrivate: false,    // Открывается после 2 часов
    reportWeight: 0.5         // Репорты от новичков весят меньше
};
```

---

# Метрики успеха

## Ключевые KPI

| Метрика | Цель Day 1 | Цель Month 1 | Цель Year 1 |
|---------|------------|--------------|-------------|
| DAU | 1,000 | 10,000 | 50,000 |
| MAU | - | 50,000 | 200,000 |
| Retention D1 | 40% | 45% | 50% |
| Retention D7 | 20% | 25% | 30% |
| Retention D30 | - | 10% | 15% |
| Avg Session | 15 min | 20 min | 25 min |
| Sessions/Day | 1.5 | 2.0 | 2.5 |

## Engagement метрики

| Метрика | Здоровое значение |
|---------|-------------------|
| Perfect Swings % | > 30% |
| Social Interactions / session | > 5 |
| Content Completion % | > 80% |
| Feature Discovery % | > 60% |

## Технические метрики

| Метрика | Порог | Критический |
|---------|-------|-------------|
| Server Latency | < 100ms | > 200ms |
| Client FPS | > 50 | < 30 |
| Crash Rate | < 0.1% | > 1% |
| Load Time | < 5s | > 10s |

---

# Roadmap

## Pre-Alpha (Month 1-2)
- [ ] Core movement system
- [ ] Basic mowing mechanic с timing
- [ ] Tile system
- [ ] Single player prototype
- [ ] Basic art assets

## Alpha (Month 3-4)
- [ ] Perfect timing system полный
- [ ] Full mowing loop с combo
- [ ] Hay collection
- [ ] Stack building
- [ ] Basic multiplayer (2 players)
- [ ] Time of day (visual)

## Closed Beta (Month 5-6)
- [ ] Full multiplayer (8 players)
- [ ] Chat system
- [ ] Campfire mechanic
- [ ] Cooking mini-game
- [ ] Day/night cycle complete
- [ ] Sound design v1
- [ ] Music v1

## Open Beta (Month 7-8)
- [ ] Fishing
- [ ] Gathering
- [ ] Personal corner
- [ ] Friend system
- [ ] Accessibility options
- [ ] Mobile optimization
- [ ] Localization (RU, EN)

## Launch (Month 9)
- [ ] Season Pass v1
- [ ] Cosmetic shop
- [ ] Full sound design
- [ ] Full polish pass
- [ ] Marketing campaign

## Post-Launch (Month 10+)
- [ ] New seasons (Autumn, Winter, Spring)
- [ ] New activities
- [ ] Guild system
- [ ] Events
- [ ] UGC tools

---

# Color Palette

```css
:root {
    /* Основные цвета */
    --grass-light: #8BC34A;
    --grass-mid: #689F38;
    --grass-dark: #558B2F;

    --hay-light: #FFF8E1;
    --hay-mid: #FFECB3;
    --hay-dark: #FFE082;

    --earth-light: #8D6E63;
    --earth-mid: #6D4C41;
    --earth-dark: #4E342E;

    /* Акценты */
    --gold: #FFD700;
    --gold-glow: rgba(255, 215, 0, 0.3);

    --fire-core: #FF6F00;
    --fire-mid: #FFC107;
    --fire-glow: #FFECB3;

    /* UI */
    --ui-wood: #5D4037;
    --ui-wood-light: #795548;
    --ui-text: #3E2723;
    --ui-text-light: #EFEBE9;
}
```

---

# Timing Constants

```javascript
const TIMING = {
    // Косьба
    SCYTHE_CHARGE_MIN: 200,       // ms
    SCYTHE_CHARGE_MAX: 1000,      // ms
    SCYTHE_PERFECT_START: 400,    // ms
    SCYTHE_PERFECT_END: 600,      // ms

    // Анимации
    SQUASH_DURATION: 100,
    STRETCH_DURATION: 80,
    RECOVERY_DURATION: 200,

    // Частицы
    GRASS_PARTICLE_LIFETIME: 500,
    SPARKLE_LIFETIME: 300,
    DUST_LIFETIME: 400,

    // UI
    COMBO_POPUP_DURATION: 1000,
    TOOLTIP_FADE_DURATION: 200,

    // Звук
    SOUND_FADE_DURATION: 100,
    MUSIC_CROSSFADE: 2000,

    // Время суток
    FULL_DAY_CYCLE: 24 * 60 * 1000, // 24 минуты реального времени

    // Мультиплеер
    INTERPOLATION_DELAY: 100,
    SYNC_RATE: 50 // ms
};
```

---

# Чек-лист Polish перед релизом

## Must Have (Критично для ощущений)
- [ ] Каждое действие имеет визуальный feedback
- [ ] Каждое действие имеет звуковой feedback
- [ ] Timing system работает точно и предсказуемо
- [ ] Combo система ощущается rewarding
- [ ] Частицы не влияют на производительность
- [ ] Музыка адаптируется к геймплею
- [ ] Финал стога = эпичный момент

## Should Have (Значительно улучшает)
- [ ] Все easing functions настроены
- [ ] Screen shake настроен и не раздражает
- [ ] Все звуки имеют вариации
- [ ] День/ночь плавно переходят
- [ ] Костер создает атмосферу
- [ ] Мультиплеер sync работает без глитчей
- [ ] Accessibility опции работают

## Nice to Have (Вишенка на торте)
- [ ] Светлячки ночью
- [ ] Падающие звезды
- [ ] Бабочки садятся на голову
- [ ] Радуга после дождя
- [ ] Секретные достижения
- [ ] Easter eggs

---

**Документ подготовлен на основе экспертизы трех специалистов:**
- Blizzard Art Director (Polish & Feel)
- Stardew Valley Designer (Loops & Retention)
- Senior Game Designer (Systems & Scale)

*Версия: 1.0 Final*
*Дата: Февраль 2026*
